# パッケージ開発者ガイド

**packagesディレクトリ専用の開発ガイド**

このドキュメントはpackagesディレクトリでのパッケージ開発に特化したガイドです。メインアプリ開発や全体的なプロジェクト設定は [../HUMAN.md](../HUMAN.md) を参照してください。

## 🎯 パッケージ開発の特徴

- **機能別開発**: 特定の機能を独立パッケージとして開発
- **Linear Issue連携**: PKG-XXX形式のIssueでパッケージ作楫を管理
- **自動統合**: ワークスペース登録やメインアプリ統合を自動化
- **再利用性**: 他プロジェクトでも使用可能な設計

## 📦 パッケージ開発コマンド

### パッケージ専用Linearコマンド

```bash
# パッケージ開発（PKG-で始まるIssue IDを使用）
/linear PKG-001    # 新規パッケージ作成
/linear PKG-002    # 既存パッケージに機能追加
/linear PKG-003    # パッケージリファクタリング
```

### パッケージ設計原則

- **単一責任**: 1パッケージ = 1機能
- **疎結合**: パッケージ間の依存最小限
- **高凝集**: 関連機能を一つのパッケージに集約

### 現在のパッケージ

- **app_preferences**: アプリ設定管理（言語、テーマ、永続化）

## ⚡ クイックスタート

### パッケージ開発（3ステップ）

```mermaid
graph LR
    A[1. claude] --> B[2. /linear PKG-123]
    B --> C[3. ☕ 待つだけ]

    style A fill:#e3f2fd
    style B fill:#fff3e0
    style C fill:#e8f5e8
```

環境設定や詳細なコマンドは [../HUMAN.md](../HUMAN.md) を参照してください。

## パッケージ開発例

### 新規パッケージ作成

```bash
claude
/linear PKG-001  # 認証パッケージ作成
# → 自動でパッケージ構造作成、実装、テスト、PR作成
```

### 既存パッケージ機能追加

```bash
claude
/linear PKG-002  # app_preferencesに新機能追加
# → 既存コードを解析して適切に拡張
```

## 📁 パッケージ構造

### 標準パッケージ構造

```
lib/
├── [package_name].dart     # 公開API
├── src/
│   ├── providers/          # Riverpod状態管理
│   ├── repositories/       # データアクセス層
│   ├── models/            # データモデル
│   ├── widgets/           # UIコンポーネント
│   └── utils/             # ユーティリティ
├── assets/                # 静的リソース
└── test/                  # テスト
```

### 自動実装フロー

1. **モデル層**: データ構造定義
2. **リポジトリ層**: データアクセス実装
3. **プロバイダー層**: Riverpod状態管理
4. **ウィジェット層**: UIコンポーネント
5. **公開API**: 外部インターフェース定義
6. **テスト**: ユニット・ウィジェット・統合テスト
7. **統合**: ワークスペース登録やメインアプリ統合

## パッケージガイドライン

### パッケージ化すべき機能

- 複数画面で使用される機能
- 独立してテスト可能な機能
- 他プロジェクトでも再利用可能な機能
- 特定のドメイン知識を含む機能

### パッケージ化しない方が良い機能

- 単一画面でのみ使用される機能
- メインアプリのロジックと密結合した機能
- 非常に小さなユーティリティ関数

## よくある質問

**Q: PKG-XXXと通常のIssue IDの違いは？**

- PKG-XXX: packagesディレクトリ専用のパッケージ開発
- 通常のID: メインアプリの機能開発

**Q: パッケージ間の依存関係は？**

- 各パッケージは独立して動作するよう設計
- 共通機能は別の専用パッケージに切り出し
- 循環依存は絶対に避ける

## トラブルシューティング

### パッケージ固有の問題

```bash
# パッケージが見つからない
melos run get

# コード生成失敗
flutter clean && melos run gen

# 循環依存エラー
# パッケージ設計を見直し、依存関係を整理
```

### 緊急時対応

```bash
# パッケージ作業の手動完了
cd packages/[package_name]
git add . && git commit -m "feat: manual package completion"
git push origin feature/PKG-XXX
```

その他のトラブルシューティングは [../HUMAN.md](../HUMAN.md) を参照してください。

## パッケージ開発のコツ

- **明確なスコープ**: 1パッケージ = 1機能領域
- **独立性**: 他パッケージに依存しない設計
- **テスタビリティ**: 単体でテスト可能な構造
- **再利用性**: 他プロジェクトでも使用可能

## まとめ

パッケージ開発のポイント:

1. **PKG-XXX形式** のIssue IDを使用
2. **単一責任** を徹底した設計
3. **自動化** で品質と効率を両立
4. **独立性** で再利用性を確保

## 参考ドキュメント

- **メインプロジェクトガイド**: [../HUMAN.md](../HUMAN.md)
- **パッケージ技術仕様**: [CLAUDE.md](CLAUDE.md)
- **Claude 4ベストプラクティス**: [../docs/CLAUDE_4_BEST_PRACTICES.md](../docs/CLAUDE_4_BEST_PRACTICES.md)
